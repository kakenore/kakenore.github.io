<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ã‚°ãƒ©ãƒ å˜ä¾¡è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      .tabs {
        display: flex;
        margin-bottom: 10px;
        gap: 5px;
      }
      .tab {
        padding: 5px 10px;
        border: 1px solid #ccc;
        cursor: pointer;
        border-radius: 6px;
        background: #eee;
      }
      .tab.active {
        background: #3498db;
        color: white;
      }
      .form {
        margin-bottom: 20px;
      }
      .products {
        margin-top: 10px;
      }
      .product {
        border-bottom: 1px solid #ccc;
        padding: 5px 0;
        display: flex;
        justify-content: space-between;
      }
      .preset-buttons button,
      .preset-pricebuttons button {
        margin: 2px;
      }
    </style>
  </head>
  <body>
    <h1>ã‚°ãƒ©ãƒ å˜ä¾¡è¨ˆç®—ã‚¢ãƒ—ãƒª</h1>

    <!-- ã‚¿ãƒ–ã‚¨ãƒªã‚¢ -->
    <div class="tabs" id="tabs"></div>
    <button onclick="addTab()">ï¼‹ã‚¿ãƒ–è¿½åŠ </button>

    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="form">
      å•†å“å: <input type="text" id="name" />
      <br />
      ã‚°ãƒ©ãƒ æ•°: <input type="number" id="grams" /> g
      <div class="preset-buttons">
        <button onclick="setGrams(100)">+100g</button>
        <button onclick="setGrams(200)">+200g</button>
        <button onclick="setGrams(500)">+500g</button>
        <button onclick="setGrams(1000)">+1000g</button>
        <button
          onclick="resetField('grams','ã‚°ãƒ©ãƒ æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')"
          style="background: #f39c12; color: white"
        >
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
      ä¾¡æ ¼: <input type="number" id="price" /> å††
      <div class="preset-pricebuttons">
        <button onclick="setPrices(100)">+100å††</button>
        <button onclick="setPrices(200)">+200å††</button>
        <button onclick="setPrices(500)">+500å††</button>
        <button onclick="setPrices(1000)">+1000å††</button>
        <button
          onclick="resetField('price','ä¾¡æ ¼ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')"
          style="background: #f39c12; color: white"
        >
          ãƒªã‚»ãƒƒãƒˆ
        </button>
      </div>
      <button onclick="addProduct()">è¿½åŠ ã™ã‚‹</button>
    </div>

    <!-- å•†å“ãƒªã‚¹ãƒˆ -->
    <div class="products" id="products"></div>

    <script>
      let tabs = [];
      let currentTabIndex = 0;

      // ---- LocalStorage ä¿å­˜ãƒ»å¾©å…ƒ ----
      function saveTabs() {
        const data = {
          tabs: tabs,
          currentTabIndex: currentTabIndex,
        };
        localStorage.setItem("tabsData", JSON.stringify(data));
      }

      function loadTabs() {
        const saved = localStorage.getItem("tabsData");
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            tabs = parsed.tabs || [{ name: "é£Ÿå“", products: [] }];
            currentTabIndex = parsed.currentTabIndex || 0;
          } catch (e) {
            console.error("å¾©å…ƒå¤±æ•—:", e);
            tabs = [{ name: "é£Ÿå“", products: [] }];
            currentTabIndex = 0;
          }
        } else {
          tabs = [{ name: "é£Ÿå“", products: [] }];
          currentTabIndex = 0;
        }
        renderTabs();
        render();
      }

      // ---- ã‚¿ãƒ–æ“ä½œ ----
      function addTab() {
        tabs.push({ name: "æ–°ã—ã„ã‚¿ãƒ–", products: [] });
        currentTabIndex = tabs.length - 1;
        renderTabs();
        render();
        saveTabs();
      }

      function switchTab(index) {
        currentTabIndex = index;
        renderTabs();
        render();
        saveTabs();
      }

      function renameTab(index) {
        const newName = prompt("ã‚¿ãƒ–åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", tabs[index].name);
        if (newName) {
          tabs[index].name = newName;
          renderTabs();
          saveTabs();
        }
      }

      function deleteTab(index) {
        if (!confirm("ã“ã®ã‚¿ãƒ–ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        tabs.splice(index, 1);
        if (tabs.length === 0) {
          tabs = [{ name: "é£Ÿå“", products: [] }];
        }
        currentTabIndex = Math.min(currentTabIndex, tabs.length - 1);
        renderTabs();
        render();
        saveTabs();
      }

      // ---- å•†å“æ“ä½œ ----
      function addProduct() {
        const name = document.getElementById("name").value;
        const grams = parseFloat(document.getElementById("grams").value);
        const price = parseFloat(document.getElementById("price").value);

        if (!name || isNaN(grams) || isNaN(price) || grams <= 0) {
          alert("æ­£ã—ã„å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          return;
        }

        const unitPrice = price / grams;
        tabs[currentTabIndex].products.push({ name, grams, price, unitPrice });

        document.getElementById("name").value = "";
        document.getElementById("grams").value = "";
        document.getElementById("price").value = "";

        render();
        saveTabs();
      }

      function deleteProduct(index) {
        if (!confirm("ã“ã®å•†å“ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
        tabs[currentTabIndex].products.splice(index, 1);
        render();
        saveTabs();
      }

      // ---- å…¥åŠ›è£œåŠ© ----
      function setGrams(value) {
        const gramsInput = document.getElementById("grams");
        let current = parseFloat(gramsInput.value) || 0;
        gramsInput.value = current + value;
      }

      function setPrices(value) {
        const priceInput = document.getElementById("price");
        let current = parseFloat(priceInput.value) || 0;
        priceInput.value = current + value;
      }

      function resetField(fieldId, message) {
        if (confirm(message)) {
          document.getElementById(fieldId).value = 0;
        }
      }

      // ---- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ----
      function renderTabs() {
        const tabsDiv = document.getElementById("tabs");
        tabsDiv.innerHTML = "";
        tabs.forEach((tab, i) => {
          const tabDiv = document.createElement("div");
          tabDiv.className = "tab" + (i === currentTabIndex ? " active" : "");
          tabDiv.textContent = tab.name;
          tabDiv.onclick = () => switchTab(i);

          // æ“ä½œç”¨ãƒœã‚¿ãƒ³
          const renameBtn = document.createElement("button");
          renameBtn.textContent = "âœï¸";
          renameBtn.onclick = (e) => {
            e.stopPropagation();
            renameTab(i);
          };

          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "ğŸ—‘ï¸";
          deleteBtn.onclick = (e) => {
            e.stopPropagation();
            deleteTab(i);
          };

          tabDiv.appendChild(renameBtn);
          tabDiv.appendChild(deleteBtn);
          tabsDiv.appendChild(tabDiv);
        });
      }

      function render() {
        const productsDiv = document.getElementById("products");
        productsDiv.innerHTML = "";
        tabs[currentTabIndex].products.forEach((p, i) => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
          <span>${p.name} : ${p.grams}g / ${p.price}å†† â†’ 
          <b>${p.unitPrice.toFixed(2)} å††/g</b></span>
          <button onclick="deleteProduct(${i})">å‰Šé™¤</button>
        `;
          productsDiv.appendChild(div);
        });
      }

      // åˆæœŸãƒ­ãƒ¼ãƒ‰
      window.onload = loadTabs;
    </script>
  </body>
</html>
